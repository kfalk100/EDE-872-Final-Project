---
output: html_document
editor_options: 
  chunk_output_type: console
---
```{r, packages, working directory}

library(tidyverse)
library (lubridate)
library(here)
library(ggplot2)

here()
getwd()

```


```{r, import the raw data csv}

pointcount_detection <- read.csv(file = here("Data","Raw","ERMN_StreamsideBirds_2315071_PointCount.csv"))

```

```{r, change date objects and create year column}

pointcount_detection$Start_Date_ISO <- ymd(pointcount_detection$Start_Date_ISO)
class(pointcount_detection$Start_Date_ISO)

pointcount_detection <- pointcount_detection %>%
  mutate(Year = year(Start_Date_ISO))

```

```{r, select columns of interest}

pointcount_detection_trim <- select(pointcount_detection,
                          Unit_Code,
                          Site_Name,
                          Year,
                          Ambient_Noise,
                          Road_Noise,
                          Common_Name,
                          Hemlock_Condition_Score,
                          Latitude,
                          Longitude
                          )

```

```{r, get rid of unidentified or absent birds, 839 unidentified and 25 no birds spotted}

detection_final <- pointcount_detection_trim %>%
  filter(!Common_Name %in% c("Unidentified Bird",
                             "Unidentified Woodpecker",
                             "Not Applicable"))

```

```{r, filter dataframe for only woodpeckers in the Delaware River Gap}

woodpeckers_delaware <- detection_final %>%
  filter(Common_Name %in% c("Downy Woodpecker",
                            "Pileated Woodpecker",
                            "Red-bellied Woodpecker",
                            "Hairy Woodpecker")) %>%
  filter(Unit_Code %in% c("DEWA"))
                   
```

```{r, changing column name for clarity}
woodpeckers_delaware <-woodpeckers_delaware %>%
  rename(National_Park = Unit_Code)

```


```{r, group by site name, year, and common name}
woodpeckers_grouped <-woodpeckers_delaware %>%
  group_by(Site_Name,Year, Common_Name) %>%
  summarise(Detection_Count = n())

```


```{r, group by site name, year, common name and then the possible explanatory variables (ambient noise, road noise, and hemlock condition)}

ambient_grouped <- woodpeckers_delaware %>%
  group_by(Site_Name,Year, Common_Name, Ambient_Noise) %>%
  summarise(Detection_Count = n())

road_grouped <- woodpeckers_delaware %>%
  group_by(Site_Name,Year, Common_Name, Road_Noise) %>%
  summarise(Detection_Count = n())

hemlock_grouped <- woodpeckers_delaware %>%
  group_by(Site_Name,Year, Common_Name, Hemlock_Condition_Score) %>%
  summarise(Detection_Count = n())

```


```{r, place the processed dataset into the processed folder}

write.csv(woodpeckers_delaware, row.names = FALSE, 
          file = here("Data","Processed","Woodpeckers_Delaware.csv"))

write.csv(woodpeckers_grouped, row.names = FALSE, 
          file = here("Data","Processed","Woodpeckers_Grouped.csv"))

write.csv(ambient_grouped, row.names = FALSE, 
          file = here("Data","Processed","Ambient_Grouped.csv"))

write.csv(road_grouped, row.names = FALSE, 
          file = here("Data","Processed","Road_Grouped.csv"))

write.csv(hemlock_grouped, row.names = FALSE, 
          file = here("Data","Processed","Hemlock_Grouped.csv"))

```


```{r}
dateincluded_trim <- select(pointcount_detection,
                          Unit_Code,
                          Site_Name,
                          Start_Date_ISO,
                          Year,
                          Ambient_Noise,
                          Road_Noise,
                          Common_Name,
                          Hemlock_Condition_Score,
                          Latitude,
                          Longitude
                          )

dateincluded_woodpeckers <- dateincluded_trim %>%
  filter(!Common_Name %in% c("Unidentified Bird",
                             "Unidentified Woodpecker",
                             "Not Applicable")) %>%
  filter(Common_Name %in% c("Downy Woodpecker",
                            "Pileated Woodpecker",
                            "Red-bellied Woodpecker",
                            "Hairy Woodpecker")) %>%
  filter(Unit_Code %in% c("DEWA"))%>%
  rename(National_Park = Unit_Code) %>%
  rename(Detection_Date = Start_Date_ISO)

```

```{r}
write.csv(dateincluded_trim, row.names = FALSE, 
          file = here("Data","Processed","Dateincluded_Woodpeckers.csv"))
```



```

